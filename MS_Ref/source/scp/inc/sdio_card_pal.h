

#ifndef _SDIO_CARD_PAL_H_
#define _SDIO_CARD_PAL_H_

#include "sci_types.h"

struct SDIO_CARD_PAL_Struct;
typedef struct SDIO_CARD_PAL_Struct* SDIO_CARD_PAL_HANDLE;

typedef enum
{
	SDIO_CARD_PAL_SLOT_0,
	SDIO_CARD_PAL_SLOT_1,
	SDIO_CARD_PAL_SLOT_2,
	SDIO_CARD_PAL_SLOT_3
,
	SDIO_CARD_PAL_SLOT_MAX
}
SDIO_CARD_PAL_SLOT_E;

PUBLIC SDIO_CARD_PAL_HANDLE SDIO_Card_Pal_Open(SDIO_CARD_PAL_SLOT_E slotNo);

typedef enum
{
	SDIO_CARD_PAL_OFF,
	SDIO_CARD_PAL_ON
}
SDIO_CARD_PAL_PWR_E;
PUBLIC BOOLEAN SDIO_Card_Pal_Pwr(SDIO_CARD_PAL_HANDLE handle,SDIO_CARD_PAL_PWR_E onOrOff);

typedef enum
{
	SDIO_CARD_PAL_400KHz,			// 初始化频率
	SDIO_CARD_PAL_20MHz,			// MMC卡的工作频率
	SDIO_CARD_PAL_25MHz,			// SD卡的工作频率
	SDIO_CARD_PAL_50MHz			// SD卡高速模式下的工作频率
}
SDIO_CARD_PAL_CLKTYPE_E;
PUBLIC BOOLEAN SDIO_Card_Pal_SetClk(SDIO_CARD_PAL_HANDLE handle,SDIO_CARD_PAL_CLKTYPE_E clkType);

typedef enum
{
	SDIO_CARD_PAL_1_BIT,
	SDIO_CARD_PAL_4_BIT,
	SDIO_CARD_PAL_8_BIT
}SDIO_CARD_PAL_BUFWIDTH_E;
PUBLIC BOOLEAN SDIO_Card_Pal_SetBusWidth(SDIO_CARD_PAL_HANDLE handle,SDIO_CARD_PAL_BUFWIDTH_E widthType);

typedef enum
{
	SDIO_CARD_PAL_LOW_SPEED,
	SDIO_CARD_PAL_HIGH_SPEED
}SDIO_CARD_PAL_SPEEDMODE_E;
PUBLIC BOOLEAN SDIO_Card_Pal_SetSpeedMode(SDIO_CARD_PAL_HANDLE handle,SDIO_CARD_PAL_SPEEDMODE_E speedMode);

typedef enum
{
// cmdindex,rsp,transmode
	CARD_CMD0_GO_IDLE_STATE,
	CARD_CMD1_SEND_OP_COND, /*MMC*/
	CARD_CMD2_ALL_SEND_CID,
	CARD_CMD3_SEND_RELATIVE_ADDR, /*SD*/
	CARD_CMD3_SET_RELATIVE_ADDR, /*MMC*/
	CARD_CMD4_SET_DSR,
	CARD_CMD6_SWITCH_FUNC,
	CARD_CMD7_SELECT_DESELECT_CARD,
	CARD_CMD8_SEND_IF_COND, /*SD*/
	CARD_CMD9_SEND_CSD,
	CARD_CMD10_SEND_CID,
	CARD_CMD11_READ_DAT_UNTIL_STOP, /*MMC*/
	CARD_CMD11_READ_DAT_UNTIL_STOP_AUT12, /*MMC*/
	CARD_CMD12_STOP_TRANSMISSION,	//It is auto performed by Host
	CARD_CMD13_SEND_STATUS,
	CARD_CMD15_GO_INACTIVE_STATE,
	CARD_CMD16_SET_BLOCKLEN,
	CARD_CMD17_READ_SINGLE_BLOCK,
	CARD_CMD18_READ_MULTIPLE_BLOCK,
	CARD_CMD18_READ_MULTIPLE_BLOCK_AUT12,
	CARD_CMD20_WRITE_DAT_UNTIL_STOP, /*MMC*/	
	CARD_CMD20_WRITE_DAT_UNTIL_STOP_AUT12, /*MMC*/
	CARD_CMD23_SET_BLOCK_COUNT, /*MMC*/
	CARD_CMD24_WRITE_BLOCK,
	CARD_CMD25_WRITE_MULTIPLE_BLOCK,
	CARD_CMD25_WRITE_MULTIPLE_BLOCK_AUT12,

	CARD_CMD26_PROGRAM_CID, /*MMC*/
	CARD_CMD27_PROGRAM_CSD,
	CARD_CMD28_SET_WRITE_PROT,
	CARD_CMD29_CLR_WRITE_PROT,
	CARD_CMD30_SEND_WRITE_PROT,	// ??

	CARD_CMD32_ERASE_WR_BLK_START, /*SD*/
	CARD_CMD33_ERASE_WR_BLK_END, /*SD*/

	CARD_CMD35_ERASE_GROUP_START, /*MMC*/
	CARD_CMD36_ERASE_GROUP_END, /*MMC*/

	CARD_CMD38_ERASE,

	CARD_CMD39_FAST_IO, /*MMC*/
	CARD_CMD40_GO_IRQ_STATE, /*MMC*/

	CARD_CMD42_LOCK_UNLOCK_SD, /*SD*/	// ??
	CARD_CMD42_LOCK_UNLOCK_MMC, /*MMC*/	// ??
	CARD_CMD55_APP_CMD,
	CARD_CMD56_GEN_CMD_SD, /*SD*/	//??
	CARD_CMD56_GEN_CMD_MMC, /*MMC*/	//??


	CARD_ACMD6_SET_BUS_WIDTH,	 /*SD*/
	CARD_ACMD13_SD_STATUS, /*SD*/
	CARD_ACMD22_SEND_NUM_WR_BLCOKS, /*SD*/
	CARD_ACMD23_SET_WR_BLK_ERASE_COUNT, /*SD*/
	CARD_ACMD41_SD_SEND_OP_COND, /*SD*/
	CARD_ACMD42_SET_CLR_CARD_DETECT, /*SD*/
	CARD_ACMD51_SEND_SCR, /*SD*/


#if defined(SPRD_SUPPORT_MCEX)
	CARD_CMD34_READ_SEC_CMD,
	CARD_CMD35_WRITE_SEC_CMD,
	CARD_CMD36_SEND_PSI,
	CARD_CMD37_CTL_TRM,
#endif

	CARD_CMDMAX
}
SDIO_CARD_PAL_CMD_E;

typedef struct CARD_DATA_PARAM_TAG
{
	uint8* databuf;	// the buffer address ,that data will be stored in or  read from
	uint32 blkLen;	// block size
	uint32 blkNum;	// block number
}
CARD_DATA_PARAM_T;

typedef enum
{
	SDIO_CARD_PAL_ERR_NONE			= 0,
	SDIO_CARD_PAL_ERR_RSP				= BIT_0,
	SDIO_CARD_PAL_ERR_CMD12			= BIT_1,
	SDIO_CARD_PAL_ERR_CUR_LIMIT		= BIT_2,
	SDIO_CARD_PAL_ERR_DATA_END		= BIT_3,
	SDIO_CARD_PAL_ERR_DATA_CRC		= BIT_4,
	SDIO_CARD_PAL_ERR_DATA_TIMEOUT	= BIT_5,
	SDIO_CARD_PAL_ERR_CMD_INDEX		= BIT_6,
	SDIO_CARD_PAL_ERR_CMD_END		= BIT_7,
	SDIO_CARD_PAL_ERR_CMD_CRC		= BIT_8,
	SDIO_CARD_PAL_ERR_CMD_TIMEOUT	= BIT_9
}
SDIO_CARD_PAL_ERROR_E;


typedef enum CARD_VERTION_E_TAG
{
	CARD_V_UNKONWN,
	CARD_SD_V1_X,
	CARD_SD_V2_0_STANDARD,
	CARD_SD_V2_0_HIGHCAP,
	CARD_MMC_331
}CARD_VERTION_E;


PUBLIC SDIO_CARD_PAL_ERROR_E SDIO_Card_Pal_SendCmd(
	/*IN*/SDIO_CARD_PAL_HANDLE handle,
	/*IN*/SDIO_CARD_PAL_CMD_E cmd,
	/*IN*/uint32 argument,
	/*IN*/CARD_DATA_PARAM_T* dataParam,
	/*OUT*/uint8* rspBuf
);

PUBLIC BOOLEAN SDIO_Card_Pal_Close(SDIO_CARD_PAL_HANDLE handle);


/* For SC6530, ATV may interfere with SDIO when SDIO works at 48MHz,
*   So we need to work around by changing SDIO base clk to 26MHz when 
*   enjoying ATV.
*/
//#define ATV_WORKAROUND
#if defined (ATV_WORKAROUND)
#define     SDIO_BASE_CLK_48M       48000000        // 48 MHz
#define     SDIO_BASE_CLK_104M      104000000        // 104 MHz
PUBLIC BOOLEAN SDIO_Card_Pal_SwichBaseClk (SDIO_CARD_PAL_HANDLE handle,uint32 sdio_base_clk);
PUBLIC SDIO_CARD_PAL_HANDLE SDIO_Card_PAL_Get_Handle (SDIO_CARD_PAL_SLOT_E slotNo);
#endif

#endif



